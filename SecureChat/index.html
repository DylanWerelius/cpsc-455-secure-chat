<!-- In simple terms, this is the front-end code -->
<!-- Written by Dylan Werelius -->
<!-- Reference: https://youtu.be/TItbp7c9MNQ -->

<html>
    <head>
        <title>SecureChat</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    </head>

    <body>
        <div class="h-screen w-screen flex flex-col justify-between">
            <div id="chat" class="p-3 overflow-auto">
                <!-- This is where the messages will go -->
            </div>
            <div class="flex">
                <input id="message" type="text" class="px-3 w-full border-t border-gray-300 outline-none text-gray-700" 
                placeholder="Type your message..." />
                <button class="px-8 py-3 bg-green-500 text-white hover:bg-green-600 transition-colors" onclick="sendMessage()">Send</button>
            </div>
        </div>

        <script>
            // Make sure this is the same port as the one in index.js
            const ws = new WebSocket("ws://localhost:3000");

            ws.addEventListener("message", function(event) {
                const data = JSON.parse(event.data);

                if (data.type == "message") {
                    addMessage(data.data);
                }
            });

            function sendMessage() {
                const message = document.getElementById("message").value;

                // This will catch if the user just clicks the send button with nothing in the text box
                if (!message) return false;

                ws.send(JSON.stringify({ type: "message", data: message }));

                addMessage(message);
                document.getElementById("message").value = "";
            }

            function addMessage(message) {
                const node = document.createElement("P");
                const text = document.createTextNode(message);

                node.appendChild(text);
                node.classList.add("text-gray-700", "py-1");

                // This will add the message to the chat on the users' screen
                document.getElementById("chat").appendChild(node);
            }
        </script>
    </body>
</html>